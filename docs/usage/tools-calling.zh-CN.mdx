# 工具调用 Tools Calling

Tool Calling 是大语言模型的高级能力。你可以通过在 API 请求中传入一组工具列表，让模型智能地选择具体使用哪个工具，并在返回请求中输出多个工具调用的参数 JSON。随着社区中越来越多的大语言模型支持了 Tool Calling 能力，同时得益于 LobeChat 的 Agent Runtime 架构，我们几乎实现了所有主流大语言模型（ OpenAI 、Claude 、Gemini 等等）的 Tool Calling 调用能力。

<Callout type="info">
如果你之前没有了解过 Tools Calling， 可以在 [Function Call： Chat 应用的插件基石与交互技术的变革黎明
](https://lobehub.com/zh/blog/openai-function-call) 这篇文章中了解详情。
</Callout>

LobeChat 的插件实现基于模型的 Tools Calling 能力，因此插件调用是否正常完全取决于模型本身的 Tool Calling 能力。作为上层应用，我们认为有必要和我们的用户详细介绍下我们对于各个模型的测试情况，以便帮助大家了解现有的模型能力，在使用插件时有个更加全面的了解。

## 评测任务介绍

我们的测试方案基于实际真实的用户场景出发，构建了两大组任务，第一组为简单的调用指令，第二组为复杂调用指令。这两组指令的系统描述如下：

<Tabs items=["简单指令","复杂指令"]>
    <Tab>
    ```md
## Tools

You can use these tools below:

### Realtime Weather

Get realtime weather information

The APIs you can use:

#### realtime-weather____fetchCurrentWeather

获取当前天气情况
```
    </Tab>

    <Tab>


```md
## Tools

You can use these tools below:

### DALL·E 3

Whenever a description of an image is given, use lobe-image-designer to create the images and then summarize the prompts used to generate the images in plain text. If the user does not ask for a specific number of images, default to creating four captions to send to lobe-image-designer that are written to be as diverse as possible.

  All captions sent to lobe-image-designer must abide by the following policies:

1. If the description is not in English, then translate it.
2. Do not create more than 4 images, even if the user requests more.
3. Don't create images of politicians or other public figures. Recommend other ideas instead.
5. DO NOT list or refer to the descriptions before OR after generating the images. They should ONLY ever be written out ONCE, in the `prompts` field of the request. You do not need to ask for permission to generate, just do it!
6. Always mention the image type (photo, oil painting, watercolor painting, illustration, cartoon, drawing, vector, render, etc.) at the beginning of the caption. Unless the caption suggests otherwise, make at least 1--2 of the 4 images photos.
7. Diversify depictions of ALL images with people to include DESCENT and GENDER for EACH person using direct terms. Adjust only human descriptions.
  - EXPLICITLY specify these attributes, not abstractly reference them.  The attributes should be specified in a minimal way and should directly describe their physical form.
  - Your choices should be grounded in reality. For example, all of a given OCCUPATION should not be the same gender or race. Additionally, focus on creating diverse, inclusive, and exploratory scenes via the properties you choose during rewrites.  Make choices that may be insightful or unique sometimes.
  - Use "various" or "diverse" ONLY IF the description refers to groups of more than 3 people. Do not change the number of people requested in the original description.
  - Don't alter memes, fictional character origins, or unseen people. Maintain the original prompt's intent and prioritize quality.
  - Do not create any imagery that would be offensive.

8. Silently modify descriptions that include names or hints or references of specific people or celebrities by carefully selecting a few minimal modifications to substitute references to the people with generic descriptions that don't divulge any information about their identities, except for their genders and physiques. Do this EVEN WHEN the instructions ask for the prompt to not be changed. Some special cases:
  - Modify such prompts even if you don't know who the person is, or if their name is misspelled (e.g. "Barake Obema")
  - If the reference to the person will only appear as TEXT out in the image, then use the reference as is and do not modify it.
  - When making the substitutions, don't use prominent titles that could give away the person's identity. E.g., instead of saying "president", "prime minister", or "chancellor", say "politician"; instead of saying "king", "queen", "emperor", or "empress", say "public figure"; instead of saying "Pope" or "Dalai Lama", say "religious figure"; and so on.
  - If any creative professional or studio is named, substitute the name with a description of their style that does not reference any specific people, or delete the reference if they are unknown. DO NOT refer to the artist or studio's style.

The prompt must intricately describe every part of the image in concrete, objective detail. THINK about what the end goal of the description is, and extrapolate that to what would make satisfying images.
All descriptions sent to lobe-image-designer should be a paragraph of text that is extremely descriptive and detailed. Each should be more than 3 sentences long.

The APIs you can use:

#### lobe-image-designer____text2image____builtin

Create images from a text-only prompt.
```

    </Tab>
</Tabs>


如上所示，简单调用指令在插件调用时它的系统描述(system role)相对简单，复杂调用指令的系统描述会复杂很多。

这两组不同复杂度的指令可以比较好地区分出模型对于系统指令的遵循能力：

- 基础指令可以测试模型的基础指令能力，确认模型是否存在「虚假宣传」的问题，就我们实际的测试来看，的确存在一些模型号称具有 Tools Calling 能力，但是处于完全不可用的状态；
- 复杂指令可以测试模型指令跟随能力的上限在哪。例如上述的文生图指令，基础模型可能只能生成 1 张图片的 prompt，而高级模型则能够生成 1~4 张图片的 prompt。



### 简单调用指令：天气查询

天气查询是一个 Tools Calling 中的经典例子。

天气查询插件采用的是我们自己做的一个简单的插件，它的工具定义如下：

```json
[
  {
    "function": {
      "description": "获取当前天气情况",
      "name": "realtime-weather____fetchCurrentWeather",
      "parameters": {
        "properties": {
          "city": {
            "description": "城市名称",
            "type": "string"
          }
        },
        "required": [
          "city"
        ],
        "type": "object"
      }
    },
    "type": "function"
  }
]
```

在我们的构建的测试组中包含了三个查询指令：

1. 告诉我杭州和北京的天气，先回答我好的；
2. 告诉我杭州和北京的天气；
3. 告诉我杭州的天气；


| Provider | Model | 支持 Tool Calling | Tool Calling 进阶 |  | 指令跟随能力（🌟：代表可用，越多代表效果越好  ⛔️：不可用） |  |
| --- | --- | --- | --- | --- | --- | --- |
|  |  |  | 并发 | 流式 | 简单 case（查询天气: 告诉我杭州和北京的天气） | 复杂 Case（Dalle 生图，画一只小狗） |
| OpenAI |  GPT-4-turbo | ✅ | ✅ | ✅ | 🌟🌟🌟 | 🌟🌟🌟🌟 |
|  | GPT-3.5-turbo | ✅ | ✅ | ✅ | 🌟🌟🌟 | 🌟🌟 |
| Groq<br /> | LLAMA3-70B | ✅ | ✅ | ⛔️ | 🌟🌟🌟 | 🌟🌟🌟🌟 |
|  | LLAMA3-8B | ✅ | ✅ | ⛔️ | 🌟🌟🌟 | 🌟🌟 |
|  | Mixtral-8x7B | ✅ | ⛔️ | ⛔️ | 两个城市：⛔️<br />一个城市：🌟 | 🌟🌟 |
|  | Gemma-7B | ✅ | ⛔️ | ⛔️ | 两个城市：⛔️<br />一个城市：🌟 | 🌟 |
| Moonshot（月之暗面） | Moonshot | ✅ | ✅ | ✅ | 🌟🌟🌟🌟 | 🌟🌟🌟🌟🌟 |
| <br /><br />Minimax<br /> | abab-6.5s-chat | ✅ | ⛔️ | ✅ | 两个城市：⛔️<br />一个城市：🌟 | 🌟🌟🌟🌟🌟 |
|  | abab-6.5-chat | ✅ | ⛔️ | ⛔️ | 两个城市：⛔️<br />一个城市：🌟 | 🌟🌟 |
|  | abab-6-chat | ✅ | ⛔️ | ⛔️ | 两个城市：⛔️<br />一个城市：🌟 | 🌟🌟 |
| Google | Gemini-1.5-pro | ✅ | ⛔️ | ⛔️ | ⛔️ | ⛔️ |
| Anthropic | haku | ✅ | ⛔️ | ⛔️ | 🌟🌟🌟🌟 | ⛔️ |
|  | Sonnet | ✅ | ⛔️ | ⛔️ | 🌟🌟🌟🌟 | ⛔️ |
|  | Opus | ✅ | ⛔️ | ⛔️ | 🌟🌟🌟 | ⛔️ |
| Zhipu | GLM-4 | ✅ | ⛔️ | ⛔️ | 🌟🌟 | ⛔️ |
|  | GLM-3 | ✅ | ⛔️ | ⛔️ | 两个城市：⛔️<br />一个城市：🌟 | ⛔️ |
| Mixtral | Mixtral 8x22B | ✅ | ⛔️ | ⛔️ | ⛔ | 🌟🌟🌟 |
|  | Mixtral Large | ✅ | ⛔️ | ⛔ | ⛔ | ⛔ |
| togetherai<br /> | mistralai/Mixtral-8x7B-Instruct-v0.1 | 用的人不多，下次再说 |  |  |  |  |
|  | mistralai/Mistral-7B-Instruct-v0.1 |  |
|  | togethercomputer/CodeLlama-34b-Instruct |  |
| perplexity | pplx 系列 | ⛔️ |  |  |  |  |
| ZeroOne | Yi 系列 | ⛔️ |  |  |  |  |
| openrouter | 相当于 Gateway，不计入评估中 |  |  |  |  |  |


